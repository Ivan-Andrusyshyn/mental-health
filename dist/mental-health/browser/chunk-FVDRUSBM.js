import{a as o,b as n,c as l}from"./chunk-KMQTTWZ2.js";import{j as A,l as I}from"./chunk-4LOI74X5.js";import{a as b}from"./chunk-XC6Q6ZZK.js";import{E as f,K as U,Y as S,da as p,g as h,ja as u}from"./chunk-M7S2SRCW.js";import{f as a}from"./chunk-BY3KSYET.js";var g={production:!0,backendUrl:"http://127.0.0.1:8000",firebaseConfig:{apiKey:"AIzaSyDZySQKBbGVduYe7ZPGQYWT9xJwLpiVI_A",authDomain:"mental-health-6b7e3.firebaseapp.com",projectId:"mental-health-6b7e3",storageBucket:"mental-health-6b7e3.appspot.com",messagingSenderId:"924061185573",appId:"1:924061185573:web:5292808328d7f374e6b1cc",measurementId:"G-N8H75H2LWJ"}};var J=(()=>{let i=class i{constructor(){this.afAuth=u(A),this.http=u(b),this.afs=u(I),this.user$=new h(null),this.userIdUrl=`${g.backendUrl}/userid`,this.initializeUserData(),this.initializeRoleData()}getUserData(){return this.user$.value}getUserDataObservable(){return this.user$.asObservable()}initializeUserData(){let e=localStorage.getItem(l);if(!e)return;let t=JSON.parse(e);e?this.user$.next(t):this.afAuth.authState.subscribe(s=>{if(!s)return;let c=this.changeUserData(s);this.user$.next(c),localStorage.setItem(l,JSON.stringify(s)),s&&this.setUserData(s)})}initializeRoleData(){let e=JSON.parse(localStorage.getItem(o)||"false"),t=JSON.parse(localStorage.getItem(n)||"false");this.isUserSubject=new h(t),this.isAdminSubject=new h(e)}getUserId(){return this.user$.pipe(f(e=>!!e),U(1),S(e=>{let t=`${g.backendUrl}/${e?.uid}`;return this.http.get(t)}))}onChangeRole(e){e===n?(this.isUserSubject.next(!0),this.isAdminSubject.next(!1)):(this.isAdminSubject.next(!0),this.isUserSubject.next(!1)),localStorage.setItem(n,JSON.stringify(this.isUserSubject.value)),localStorage.setItem(o,JSON.stringify(this.isAdminSubject.value))}getIsUserObservable(){return this.isUserSubject.asObservable()}getIsAdminObservable(){return this.isAdminSubject.asObservable()}loginUser(){return a(this,null,function*(){(yield this.afAuth.currentUser)&&this.onChangeRole(n)})}loginAdmin(){return a(this,null,function*(){(yield this.afAuth.currentUser)&&this.onChangeRole(o)})}signIn(e,t,s){return a(this,null,function*(){if(yield this.afAuth.currentUser){alert("User is already logged in.");return}try{let r=yield this.afAuth.signInWithEmailAndPassword(e,t);yield this.handleAuthSuccess(r.user,s)}catch(r){console.error("Login error: ",r),alert(r.message)}})}signUp(e,t,s,c){return a(this,null,function*(){try{if(yield this.afAuth.currentUser){alert("User is already logged in.");return}if((yield this.afAuth.fetchSignInMethodsForEmail(e)).length>0){alert("User already exists.");return}let m=yield this.afAuth.createUserWithEmailAndPassword(e,t);yield m.user?.updateProfile({displayName:s}),yield this.handleAuthSuccess(m.user,c)}catch(r){console.error("Registration error: ",r),alert(r.message)}})}handleAuthSuccess(e,t){return a(this,null,function*(){e&&(yield this.setUserData(e),this.onChangeRole(t))})}forgotPassword(e){return a(this,null,function*(){try{yield this.afAuth.sendPasswordResetEmail(e),alert("Password reset email sent, check your inbox.")}catch(t){console.error("Error sending password reset email: ",t),alert(t)}})}get isLoggedIn(){let e=localStorage.getItem(l);if(!e)return!1;let t=JSON.parse(e);return t!==null&&t.emailVerified!==!1}setUserData(e){return a(this,null,function*(){let t=this.afs.doc(`users/${e.uid}`),s=this.changeUserData(e);this.user$.next(s),yield t.set(s,{merge:!0})})}changeUserData(e){return{uid:e.uid,email:e.email||"",displayName:e.displayName||"",photoURL:e.photoURL||"",emailVerified:e.emailVerified}}logout(){this.afAuth.signOut().then(()=>{this.isUserSubject.next(!1),this.isAdminSubject.next(!1),this.user$.next(null),localStorage.setItem(n,JSON.stringify(this.isUserSubject.value)),localStorage.setItem(o,JSON.stringify(this.isAdminSubject.value)),localStorage.removeItem(l)}).catch(e=>{console.error("Logout error: ",e)})}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"});let d=i;return d})();export{g as a,J as b};
