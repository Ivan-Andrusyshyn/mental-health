import{j as A,l as I}from"./chunk-NYRVL7EU.js";import{a as b}from"./chunk-SFKR6NCK.js";import{E as f,K as p,Y as U,da as S,g as n,ja as o}from"./chunk-HITTG77O.js";import{f as r}from"./chunk-BY3KSYET.js";var h={production:!0,backendUrl:"http://127.0.0.1:8000",firebaseConfig:{apiKey:"AIzaSyDZySQKBbGVduYe7ZPGQYWT9xJwLpiVI_A",authDomain:"mental-health-6b7e3.firebaseapp.com",projectId:"mental-health-6b7e3",storageBucket:"mental-health-6b7e3.appspot.com",messagingSenderId:"924061185573",appId:"1:924061185573:web:5292808328d7f374e6b1cc",measurementId:"G-N8H75H2LWJ"}};var d="Admin",l="User",c="user",L=(()=>{let a=class a{constructor(){this.afAuth=o(A),this.http=o(b),this.afs=o(I),this.user$=new n(null),this.userIdUrl=`${h.backendUrl}/userid`,this.initializeUserData(),this.initializeRoleData()}getUserData(){return this.user$.value}initializeUserData(){let e=JSON.parse(localStorage.getItem(c)||"null");e?this.user$.next(e):this.afAuth.authState.subscribe(t=>{this.user$.next(t),localStorage.setItem(c,JSON.stringify(t)),t&&this.setUserData(t)})}initializeRoleData(){let e=JSON.parse(localStorage.getItem(d)||"false"),t=JSON.parse(localStorage.getItem(l)||"true");this.isUserSubject=new n(t),this.isAdminSubject=new n(e)}getUserId(){return this.user$.pipe(f(e=>!!e),p(1),U(e=>{let t=`${h.backendUrl}/${e?.uid}`;return this.http.get(t)}))}onChangeRole(e){e===l?(this.isUserSubject.next(!0),this.isAdminSubject.next(!1)):(this.isAdminSubject.next(!0),this.isUserSubject.next(!1)),this.updateLocalStorage()}getIsUserObservable(){return this.isUserSubject.asObservable()}getIsAdminObservable(){return this.isAdminSubject.asObservable()}loginUser(){return r(this,null,function*(){(yield this.afAuth.currentUser)&&this.onChangeRole(l)})}loginAdmin(){return r(this,null,function*(){(yield this.afAuth.currentUser)&&this.onChangeRole(d)})}signIn(e,t,i){return r(this,null,function*(){if(yield this.afAuth.currentUser){alert("User is already logged in.");return}try{let s=yield this.afAuth.signInWithEmailAndPassword(e,t);yield this.handleAuthSuccess(s.user,i)}catch(s){console.error("Login error: ",s),alert(s.message)}})}signUp(e,t,i,m){return r(this,null,function*(){try{if(yield this.afAuth.currentUser){alert("User is already logged in.");return}if((yield this.afAuth.fetchSignInMethodsForEmail(e)).length>0){alert("User already exists.");return}let g=yield this.afAuth.createUserWithEmailAndPassword(e,t);yield g.user?.updateProfile({displayName:i}),yield this.handleAuthSuccess(g.user,m)}catch(s){console.error("Registration error: ",s),alert(s.message)}})}handleAuthSuccess(e,t){return r(this,null,function*(){e&&(yield this.setUserData(e),this.onChangeRole(t))})}forgotPassword(e){return r(this,null,function*(){try{yield this.afAuth.sendPasswordResetEmail(e),alert("Password reset email sent, check your inbox.")}catch(t){console.error("Error sending password reset email: ",t),alert(t)}})}get isLoggedIn(){let e=JSON.parse(localStorage.getItem(c));return e!==null&&e.emailVerified!==!1}setUserData(e){return r(this,null,function*(){let t=this.afs.doc(`users/${e.uid}`),i={uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,emailVerified:e.emailVerified};yield t.set(i,{merge:!0})})}logout(){this.afAuth.signOut().then(()=>{this.isUserSubject.next(!0),this.isAdminSubject.next(!1),this.user$.next(null),localStorage.removeItem(c),this.updateLocalStorage()}).catch(e=>{console.error("Logout error: ",e)})}updateLocalStorage(){localStorage.setItem(l,JSON.stringify(this.isUserSubject.value)),localStorage.setItem(d,JSON.stringify(this.isAdminSubject.value))}};a.\u0275fac=function(t){return new(t||a)},a.\u0275prov=S({token:a,factory:a.\u0275fac,providedIn:"root"});let u=a;return u})();export{h as a,L as b};
